<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠˆì˜ ë¹„ë°€ì •ì›: ë†ì‘ë¬¼ ì¬ë°°</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f8ff; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
            font-family: 'Arial', sans-serif;
            color: #333;
            margin: 0;
            overflow: hidden; /* ì»¤ì„œ ì´ë¯¸ì§€ë¡œ ì¸í•´ ìŠ¤í¬ë¡¤ ìƒê¸°ëŠ” ê²ƒ ë°©ì§€ */
            cursor: default; /* ê¸°ë³¸ ì»¤ì„œ */
        }

        /* ì»¤ì„œ ì´ë¯¸ì§€ ì„¤ì • */
        body.cursor-shovel { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="orange" d="M13 14H11V6H13M12 2A9 9 0 0 0 3 11V22H21V11A9 9 0 0 0 12 2Z"/></svg>') 15 15, auto; }
        body.cursor-seed { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="green" d="M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2M12 4C14.75 4 17 6.25 17 9C17 11.75 12 18 12 18S7 11.75 7 9C7 6.25 9.25 4 12 4Z"/></svg>') 15 15, auto; }
        body.cursor-water { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="blue" d="M12 20C10 20 5 13 5 9C5 5.14 8.14 2 12 2C15.86 2 19 5.14 19 9C19 13 14 20 12 20Z"/></svg>') 15 15, auto; }
        body.cursor-scissor { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="grey" d="M20 4.47L17.5 7L20 9.53V10.47L17.5 13L20 15.53V16.47L17.5 19L20 21.53V22.47L15.47 18H8.53L4 22.47V21.53L6.5 19L4 16.47V15.53L6.5 13L4 10.47V9.53L6.5 7L4 4.47V3.53L8.53 8H15.47L20 3.53V4.47Z"/></svg>') 15 15, auto; }
        body.cursor-medicine { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="purple" d="M13 3H11V8H13M12 20A8 8 0 0 0 20 12A8 8 0 0 0 12 4A8 8 0 0 0 4 12A8 8 0 0 0 12 20Z"/></svg>') 15 15, auto; }
        body.cursor-heal { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="red" d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z"/></svg>') 15 15, auto; }
        
        #game-container {
            display: flex;
            gap: 50px; /* í™”ë¶„ ì‚¬ì´ ê°„ê²© */
            margin-top: 30px;
        }

        .plot-wrapper {
            position: relative;
            width: 250px;
            height: 350px;
            background-color: #8B4513; /* í™ ìƒ‰ìƒ */
            border-radius: 15px;
            border: 5px solid #5A2D0C;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* ì‹ë¬¼ì„ ë°”ë‹¥ì— ë¶™ì—¬ì„œ */
            align-items: center;
            cursor: pointer; /* ê¸°ë³¸ì ìœ¼ë¡œ í´ë¦­ ê°€ëŠ¥ */
            overflow: hidden; /* ì‹ë¬¼ ì´ë¯¸ì§€ê°€ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šê²Œ */
        }

        .crop-display {
            font-size: 150px; /* ì‹ë¬¼ ì´ëª¨ì§€ í¬ê¸° */
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }
        
        .status-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            text-align: left;
            z-index: 20;
        }

        .warning-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: red;
            font-weight: bold;
            font-size: 18px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            z-index: 30;
            display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        }

        #item-bar {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            background-color: #d4e6f1; /* ì•„ì´í…œ ë°” ë°°ê²½ */
            padding: 15px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .item-button {
            width: 70px;
            height: 70px;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
        }

        .item-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.2);
        }

        .item-button.selected {
            border-color: #007bff;
            box-shadow: 0 0 0 3px #007bff;
            transform: translateY(-5px) scale(1.05);
        }

        #timer-display {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #0056b3;
        }

        #game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 48px;
            font-weight: bold;
            z-index: 100;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }
        #game-over-screen button {
            margin-top: 30px;
            padding: 15px 30px;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            border: none;
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>

    <div id="timer-display">ë‚¨ì€ ì‹œê°„: <span id="time-left">30</span>ì´ˆ | ë‚ ì§œ: <span id="current-day">1</span>ì¼ / 30ì¼</div>

    <div id="game-container">
        <div class="plot-wrapper" id="plot-1">
            <div class="crop-display" id="crop-visual-1"></div>
            <div class="status-overlay">
                ìƒíƒœ: <span id="status-1">ë¹ˆ ë•…</span><br>
                ë¬¼: <span id="water-1">0</span>/6<br>
                ì¡ì´ˆ: <span id="weed-1">0</span>/2<br>
                í•´ì¶©: <span id="pest-1">0</span>/4
            </div>
            <div class="warning-message" id="warning-1"></div>
        </div>

        <div class="plot-wrapper" id="plot-2">
            <div class="crop-display" id="crop-visual-2"></div>
            <div class="status-overlay">
                ìƒíƒœ: <span id="status-2">ë¹ˆ ë•…</span><br>
                ë¬¼: <span id="water-2">0</span>/6<br>
                ì¡ì´ˆ: <span id="weed-2">0</span>/2<br>
                í•´ì¶©: <span id="pest-2">0</span>/4
            </div>
            <div class="warning-message" id="warning-2"></div>
        </div>
    </div>

    <div id="item-bar">
        <button class="item-button" data-tool="shovel" onclick="selectTool('shovel')">
            <span role="img" aria-label="ì‚½">â›ï¸</span>
        </button>
        <button class="item-button" data-tool="seed" onclick="selectTool('seed')">
            <span role="img" aria-label="ì”¨ì•—">ğŸŒ±</span>
        </button>
        <button class="item-button" data-tool="water" onclick="selectTool('water')">
            <span role="img" aria-label="ë¬¼ì¡°ê°œ">ğŸ’§</span>
        </button>
        <button class="item-button" data-tool="scissor" onclick="selectTool('scissor')">
            <span role="img" aria-label="ê°€ìœ„">âœ‚ï¸</span>
        </button>
        <button class="item-button" data-tool="medicine" onclick="selectTool('medicine')">
            <span role="img" aria-label="í•´ì¶©ì•½">ğŸ’Š</span>
        </button>
        <button class="item-button" data-tool="heal" onclick="selectTool('heal')">
            <span role="img" aria-label="íšŒë³µì œ">ğŸ©¹</span>
        </button>
    </div>

    <div id="game-over-screen">
        <span id="game-result"></span>
        <button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <script>
        // === ê²Œì„ ì„¤ì • ===
        const TOTAL_DAYS = 30;
        const DAY_DURATION_SECONDS = 30; // 1ì¼ = 30ì´ˆ
        const REQUIRED_WATER = 6;
        const REQUIRED_WEED = 2; // ì¡ì´ˆ ì œê±° íšŸìˆ˜
        const REQUIRED_PEST = 4; // í•´ì¶© ì•½ ì‚¬ìš© íšŸìˆ˜

        // === ê²Œì„ ë³€ìˆ˜ ===
        let currentDay = 1;
        let timeLeftInDay = DAY_DURATION_SECONDS;
        let selectedTool = null;
        let gameInterval;
        let gameRunning = true;

        // ê° ë†ì‘ë¬¼ì˜ ìƒíƒœ ë°ì´í„°
        const cropPlots = [
            { id: 1, stage: 0, water: 0, weed: 0, pest: 0, isDead: false, completed: false },
            { id: 2, stage: 0, water: 0, weed: 0, pest: 0, isDead: false, completed: false }
        ];

        // === DOM ìš”ì†Œ ìºì‹± ===
        const $timeLeft = document.getElementById('time-left');
        const $currentDay = document.getElementById('current-day');
        const $itemBar = document.getElementById('item-bar');
        const $body = document.body;
        const $gameOverScreen = document.getElementById('game-over-screen');
        const $gameResult = document.getElementById('game-result');

        // === ë†ì‘ë¬¼ ì‹œê°í™” ë§¤í•‘ (Stage -> Emoji) ===
        const CROP_VISUALS = [
            'ğŸ•³ï¸', // Stage 0: ë¹ˆ ë•…
            'ğŸ•³ï¸âœ¨', // Stage 1: ë•… íŒœ
            'ğŸŒ±', // Stage 2: ì”¨ì•— ì‹¬ìŒ (ìƒˆì‹¹)
            'ğŸŒ¼'  // Stage 3: ì™„ì„±ëœ ì‘ë¬¼
        ];

        // === í•¨ìˆ˜ ì •ì˜ ===

        /**
         * ë„êµ¬ë¥¼ ì„ íƒí•˜ê³  ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
         * @param {string} toolName - ì„ íƒëœ ë„êµ¬ì˜ ì´ë¦„ ('shovel', 'seed' ë“±)
         */
        function selectTool(toolName) {
            // ì´ì „ì— ì„ íƒëœ ë„êµ¬ì˜ ìŠ¤íƒ€ì¼ ì œê±°
            if (selectedTool) {
                const prevButton = $itemBar.querySelector(`.item-button[data-tool="${selectedTool}"]`);
                if (prevButton) prevButton.classList.remove('selected');
                $body.classList.remove(`cursor-${selectedTool}`);
            }

            selectedTool = toolName;

            // ìƒˆë¡­ê²Œ ì„ íƒëœ ë„êµ¬ì˜ ìŠ¤íƒ€ì¼ ì ìš©
            const newButton = $itemBar.querySelector(`.item-button[data-tool="${selectedTool}"]`);
            if (newButton) newButton.classList.add('selected');
            $body.classList.add(`cursor-${selectedName}`); // CSS í´ë˜ìŠ¤ ì¶”ê°€
        }

        /**
         * ë†ì‘ë¬¼ì— ë„êµ¬ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
         * @param {number} plotId - ìƒí˜¸ì‘ìš©í•  ë†ì‘ë¬¼ ìŠ¬ë¡¯ ID (1 ë˜ëŠ” 2)
         */
        function applyTool(plotId) {
            if (!gameRunning || !selectedTool) return;

            const plot = cropPlots[plotId - 1]; // ë°°ì—´ ì¸ë±ìŠ¤ëŠ” 0ë¶€í„° ì‹œì‘

            // ì´ë¯¸ ì™„ì„±ë˜ì—ˆê±°ë‚˜ ì£½ì€ ì‘ë¬¼ ì²˜ë¦¬
            if (plot.completed) {
                showMessage(plotId, "ì´ë¯¸ ì™„ì„±ëœ ì‘ë¬¼ì…ë‹ˆë‹¤!");
                return;
            }
            if (plot.isDead && selectedTool !== 'heal') {
                showMessage(plotId, "ì£½ì€ ì‘ë¬¼ì…ë‹ˆë‹¤! íšŒë³µì œë¡œ ì‚´ë ¤ì£¼ì„¸ìš”.");
                return;
            }

            // ë„êµ¬ë³„ ë¡œì§
            switch (selectedTool) {
                case 'shovel': // ëª¨ì¢…ì‚½: ë¹ˆ ë•… -> ë•… íŒœ
                    if (plot.stage === 0) plot.stage = 1;
                    break;
                case 'seed': // ì”¨ì•—: ë•… íŒœ -> ì”¨ì•— ì‹¬ìŒ
                    if (plot.stage === 1) plot.stage = 2;
                    break;
                case 'water': // ë¬¼ì¡°ê°œ: ë¬¼ ì£¼ê¸°
                    if (plot.stage === 2 && plot.water < REQUIRED_WATER) plot.water++;
                    break;
                case 'scissor': // ê°€ìœ„: ì¡ì´ˆ ì œê±°
                    if (plot.stage === 2 && plot.weed < REQUIRED_WEED) plot.weed++;
                    break;
                case 'medicine': // í•´ì¶©ì•½: í•´ì¶© ì œê±°
                    if (plot.stage === 2 && plot.pest < REQUIRED_PEST) plot.pest++;
                    break;
                case 'heal': // íšŒë³µì œ: ì£½ì€ ì‘ë¬¼ -> ë¹ˆ ë•…
                    if (plot.isDead) {
                        plot.isDead = false;
                        plot.stage = 0;
                        plot.water = 0;
                        plot.weed = 0;
                        plot.pest = 0;
                        showMessage(plotId, "ì‘ë¬¼ì´ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤!");
                    }
                    break;
            }

            checkCropCompletion(plot); // ì‘ë¬¼ ì™„ì„± ì—¬ë¶€ í™•ì¸
            updateUI(); // UI ì—…ë°ì´íŠ¸
        }

        /**
         * ë†ì‘ë¬¼ì˜ ì™„ì„± ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
         * @param {object} plot - í•´ë‹¹ ë†ì‘ë¬¼ì˜ ë°ì´í„° ê°ì²´
         */
        function checkCropCompletion(plot) {
            if (plot.stage === 2 &&
                plot.water >= REQUIRED_WATER &&
                plot.weed >= REQUIRED_WEED &&
                plot.pest >= REQUIRED_PEST &&
                !plot.isDead) {
                plot.stage = 3; // ì™„ì„± ë‹¨ê³„
                plot.completed = true;
                showMessage(plot.id, "ì‘ë¬¼ ì™„ì„±!");
            }
        }

        /**
         * ê²Œì„ UI (íƒ€ì´ë¨¸, ë‚ ì§œ, ë†ì‘ë¬¼ ìƒíƒœ)ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         */
        function updateUI() {
            $timeLeft.innerText = timeLeftInDay;
            $currentDay.innerText = currentDay;

            cropPlots.forEach(plot => {
                const id = plot.id;
                document.getElementById(`crop-visual-${id}`).innerText = CROP_VISUALS[plot.stage];
                document.getElementById(`status-${id}`).innerText = plot.isDead ? "ì£½ìŒğŸ¥€" :
                                                                     plot.completed ? "ì™„ì„±!âœ¨" :
                                                                     plot.stage === 0 ? "ë¹ˆ ë•…" :
                                                                     plot.stage === 1 ? "ë•… íŒœ" :
                                                                     "ì„±ì¥ ì¤‘";
                document.getElementById(`water-${id}`).innerText = plot.water;
                document.getElementById(`weed-${id}`).innerText = plot.weed;
                document.getElementById(`pest-${id}`).innerText = plot.pest;

                // ì£½ì€ ì‘ë¬¼ì€ íŠ¹ë³„í•œ ë¹„ì£¼ì–¼ë¡œ í‘œì‹œ
                if (plot.isDead) {
                    document.getElementById(`crop-visual-${id}`).innerText = 'ğŸ’€';
                }
            });
        }

        /**
         * íŠ¹ì • ë†ì‘ë¬¼ì— ê²½ê³  ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
         * @param {number} plotId - ë†ì‘ë¬¼ ID
         * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
         */
        function showMessage(plotId, message) {
            const $warningDiv = document.getElementById(`warning-${plotId}`);
            $warningDiv.innerText = message;
            $warningDiv.style.display = 'block';
            setTimeout(() => {
                $warningDiv.style.display = 'none';
            }, 1500); // 1.5ì´ˆ í›„ ì‚¬ë¼ì§
        }

        /**
         * ìì—°ì¬í•´ (í•´ì¶©/ì¡ì´ˆ)ë¥¼ ë¬´ì‘ìœ„ë¡œ ë°œìƒì‹œí‚µë‹ˆë‹¤.
         */
        function triggerNaturalDisaster() {
            // ì´ë¯¸ ì™„ì„±ë˜ì—ˆê±°ë‚˜ ì£½ì€ ì‘ë¬¼ì—ëŠ” ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ
            const availablePlots = cropPlots.filter(p => !p.isDead && !p.completed);

            if (availablePlots.length === 0) return;

            const targetPlot = availablePlots[Math.floor(Math.random() * availablePlots.length)];
            const disasterType = Math.random() > 0.5 ? 'pest' : 'weed';

            if (disasterType === 'pest') {
                targetPlot.pest = Math.min(targetPlot.pest + 1, REQUIRED_PEST); // í•´ì¶© ì¦ê°€
                showMessage(targetPlot.id, "í•´ì¶© ë°œìƒ! ğŸ›");
            } else {
                targetPlot.weed = Math.min(targetPlot.weed + 1, REQUIRED_WEED); // ì¡ì´ˆ ì¦ê°€
                showMessage(targetPlot.id, "ì¡ì´ˆ ë°œìƒ! ğŸŒ±");
            }

            // ì¼ì • í™•ë¥ ë¡œ ì‘ë¬¼ ì‚¬ë§ (ê·œì¹™ 8)
            if (Math.random() < 0.2 && targetPlot.stage === 2) { // ì„±ì¥ ì¤‘ì¸ ì‘ë¬¼ë§Œ ì£½ìŒ
                targetPlot.isDead = true;
                showMessage(targetPlot.id, "ìì—°ì¬í•´ë¡œ ì£½ì—ˆìŠµë‹ˆë‹¤... ğŸ’€");
            }

            updateUI();
        }

        /**
         * ê²Œì„ ì˜¤ë²„ í™”ë©´ì„ í‘œì‹œí•˜ê³  ê²°ê³¼ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
         * @param {boolean} success - ì„±ê³µ ì—¬ë¶€
         */
        function gameOver(success) {
            gameRunning = false;
            clearInterval(gameInterval);
            $gameOverScreen.style.display = 'flex';
            if (success) {
                $gameResult.innerText = "ì„±ê³µ! ğŸ¥³ ëª¨ë“  ì‘ë¬¼ ì¬ë°° ì™„ë£Œ!";
                $gameOverScreen.style.backgroundColor = 'rgba(40, 167, 69, 0.8)'; // ì´ˆë¡ìƒ‰ ë°°ê²½
            } else {
                $gameResult.innerText = "ì‹¤íŒ¨! ğŸ˜¥ ë‹¤ìŒ ê¸°íšŒì—...";
                $gameOverScreen.style.backgroundColor = 'rgba(220, 53, 69, 0.8)'; // ë¹¨ê°„ìƒ‰ ë°°ê²½
            }
        }

        /**
         * ê²Œì„ ì´ˆê¸°í™” ë° ì‹œì‘ í•¨ìˆ˜
         */
        function initGame() {
            currentDay = 1;
            timeLeftInDay = DAY_DURATION_SECONDS;
            selectedTool = null;
            gameRunning = true;

            cropPlots.forEach(plot => {
                plot.stage = 0;
                plot.water = 0;
                plot.weed = 0;
                plot.pest = 0;
                plot.isDead = false;
                plot.completed = false;
            });

            updateUI();
            $gameOverScreen.style.display = 'none';
            $body.className = ''; // ëª¨ë“  ì»¤ì„œ í´ë˜ìŠ¤ ì œê±°

            // ë†ì‘ë¬¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.getElementById('plot-1').onclick = () => applyTool(1);
            document.getElementById('plot-2').onclick = () => applyTool(2);

            // 1ì´ˆë§ˆë‹¤ ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸
            gameInterval = setInterval(() => {
                if (!gameRunning) return;

                timeLeftInDay--;
                if (timeLeftInDay <= 0) {
                    timeLeftInDay = DAY_DURATION_SECONDS;
                    currentDay++;

                    // ì¼ì • í™•ë¥ ë¡œ ìì—°ì¬í•´ ë°œìƒ
                    if (currentDay <= TOTAL_DAYS && Math.random() < 0.4) { // í•˜ë£¨ê°€ ë°”ë€” ë•Œ 40% í™•ë¥ ë¡œ
                        triggerNaturalDisaster();
                    }
                }

                updateUI();

                // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ í™•ì¸
                const allCompleted = cropPlots.every(plot => plot.completed);
                if (currentDay > TOTAL_DAYS) {
                    gameOver(allCompleted); // 30ì¼ ì§€ë‚˜ë©´ ê²°ê³¼ í™•ì¸
                } else if (allCompleted && currentDay <= TOTAL_DAYS) {
                    gameOver(true); // 30ì¼ ì´ì „ì— ëª¨ë‘ ì™„ì„± ì‹œ ì¦‰ì‹œ ì„±ê³µ
                }
            }, 1000); // 1ì´ˆë§ˆë‹¤ ì‹¤í–‰
        }

        // ê²Œì„ ì‹œì‘!
        initGame();

    </script>
</body>
</html>